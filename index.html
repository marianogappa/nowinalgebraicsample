<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Irving Chernev's Practical Chess Endings: Now in Algebraic!</title>
    <link rel="stylesheet" href="css/chessboard-0.3.0.min.css" />
    <link href='https://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>
    <style>
        body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,form,fieldset,input,textarea,p,blockquote,th,td,hr {
        margin:0;
        padding:0;
        }
        table {
        border-collapse:collapse;
        border-spacing:0;
        }
        fieldset,img {
        border:0;
        }
        address,caption,cite,code,dfn,em,strong,th,var {
        font-style:normal;
        font-weight:normal;
        }
        ol,ul {
        list-style:none;
        }
        caption,th {
        text-align:left;
        }
        h1,h2,h3,h4,h5,h6 {
        font-size:100%;
        font-weight:normal;
        }
        q:before,q:after {
        content:'';
        }
        abbr,acronym { border:0;
        }
    </style>

    <style>
        body {
            font-size: 16px;
            font-family: 'PT Serif';
            padding: 0px;
            margin: 0px;
        }
        section {
            padding-left: 15px;
        }
        i {
            font-weight: normal;
            color: red;
            padding-right: 10px;
        }
        h1 {
            font-weight: bolder;
            font-size: 24px;
            padding-top: 20px;
            padding-bottom: 10px;
        }
        h3 {
            font-weight: bolder;
            color: #444;
            font-size: 18px;
            /* padding-top: 10px; */
            padding-bottom: 10px;
        }
        a {
            text-decoration: none;
        }
        .examples a {
            display: inline-block;
            padding-left: 15px;
            padding-bottom: 5px;
        }
        .line {
            padding-bottom: 3px;
            font-size: 14px;
        }
        .currentMove {
            color: black !important;
            font-weight: bolder;
        }
        .play {
            color: white;
            font-weight: bolder;
            background-color: rgb(240, 0, 0);
            border: 1px solid rgb(200, 0, 0);
        }
        .play:hover {
            background-color: rgb(220, 0, 0);
            box-shadow: 1px 1px 1px gray;
        }
        #previous {
            margin-right: 10px;
        }
        textarea {
            display: inline-block;
            height: 200px;
            width: 380px;
            padding: 10px;
            font-size: 13px;
            font-family: 'PT Serif';
            border-color: #CCC;
        }
        #actionswr, #board, .examples {
            display: inline-block;
            vertical-align: top;
        }
        #actionswr {
            padding-left: 15px;
        }
        #board {
            margin-bottom: 15px;
        }
        footer {
            position: fixed; bottom: 0px; width: 100%; height: 50px; background-color: gray; color: white;
            line-height: 50px;
            padding-left: 15px;
        }
        footer a {
            font-family: "Open Sans", sans-serif;
            font-size: 14px;
            text-decoration: none;
            color: white;
            padding-right: 15px;
        }
        footer a:hover {
            text-decoration: underline;
        }
        #gameNumberInput, #gameNumberInputButton {
            height: 30px;
            margin: 0px;
            padding: 5px 15px 5px 15px;
            font-size: 14px;
            box-sizing: content-box
        }
        .gameSelector { display: inline }
        #previousGame, #previousVariant { margin-right: 10px; }
        #previousVariant { margin-left: 50px; }
        #nextGame, #nextVariant { margin-left: 10px; }
        .move { color:blue }
        .button {
            padding: 5px 10px 5px 10px;
            background-color: #CCC;
            text-decoration: none;
            border: 1px solid #666;
            display: inline-block;
            margin-bottom: 3px;
            color: black;
        }
        .button:active {
            background-color: #AAA;
        }
        #actions { margin-top: 10px; }
        #actions a { cursor: pointer; }

        /* Styling for chess board closer to book */
        /* .white-1e1d7 { background-color: white;}
        .black-3c85d { 
            background: 
                repeating-linear-gradient(
                    135deg,
                    transparent,
                    transparent 0px,
                    #444 2px,
                    #444 3px
                );
        }*/
        .board-b72b1 { border: 5px double #404040; padding: 1px; }
        .notation-322f9 { color: black; font-size: 16px;}
        .alpha-d2270 { bottom: -23px; right: 19px; }
        .numeric-fc462 { top: 16px; left: -20px; } 
        body { margin-left: 10px; } /* To account for the Chess board number's negative margin */
        p { padding-top: 5px; }
        .twoColumnGrid { 
            display: grid;
            grid-template-columns: 600px 500px;
            padding-bottom: 20px;
        }
        .rightColumn { text-align: justify; display:hidden !important }
        .rightColumn i { color: black; font-style: italic; }
        .rightColumn p { margin-bottom: 10px; margin-top: 10px; }
        #actionswr { width: 150px; }
        .grandmasterYear { padding-top: 10px;  padding-bottom: 20px; }

        .notationLine{ text-align: center; }
        .notationMoveNumber { width: 10px; display: inline-block; text-align: left; }
        .notationBlackMove { width: 80px; display: inline-block; text-align: left; }
        .notationWhiteMove { width: 80px; display: inline-block; text-align: left; }
    </style>
</head>
<body>

<section>
    <h1>Irving Chernev's Practical Chess Endings:<br/>Now in Algebraic!</h1>
    <div class="gameSelector">
        <a class="button" id="previousGame" href="javascript:previousGame()">&lt</a>
        Game <span id="gameNumber">2</span>
        <a class="button" id="nextGame" href="javascript:nextGame()">&gt</a></h3>
    </div>
    <div class="gameSelector variantSelector">
        <a class="button" id="previousVariant" href="javascript:previousVariant()">&lt</a>
        <span id="variantDescription">See variants</span>
        <a class="button" id="nextVariant" href="javascript:nextVariant()">&gt</a></h3>
    </div>
    <div class="twoColumnGrid">
        <div class="leftColumn">
            <div>
                <div id="board" style="width: 400px"></div>
                <div id="actionswr">
                    <a class="button" id="previous" href="javascript:previous()">&lt</a><a class="button" id="next" href="javascript:next()">&gt</a>
                    <div id="actions"></div>
                </div>
            </div>
            <div class="grandmasterYear"></div>
            <h3>Switch to game (1 to 25)</h3>
            <input id="gameNumberInput" size="3" type="number" min="1" max="25" value="1" maxlength="3" />
            <a id="gameNumberInputButton" href="javascript:updateCurrentGame(parseInt(document.querySelector('#gameNumberInput').value))">Switch</a>                    
        </div>
        <div class="rightColumn">

        </div>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="js/chessboard-0.3.0.min.js"></script>
<script type="text/javascript" src="ostinato.js?v=1"></script>
<script type="text/javascript" src="data.js"></script>
<script>
let board = null
let currentPosition = -1
let positions = []

let currentGame = "2"
let currentVariant = 0
let parsedNotation = null

const init = () => {
    board = ChessBoard('board');
    board.start()
    switchGame(currentGame)
    window.setTimeout(() => switchGame(1), 200)
}

const switchGame = (gn, vr = 0) => {
    currentPosition = -1
    currentGame = gn
    currentVariant = vr
    parsedNotation = ostinato.parseNotation(games[currentGame][currentVariant].actions, games[currentGame][currentVariant].initialBoard)
    positions = parsedNotation.boards
    refresh()
}

const previousGame = () => updateCurrentGame(parseInt(currentGame)-1)
const nextGame = () => updateCurrentGame(parseInt(currentGame)+1)
const previousVariant = () => updateCurrentGame(parseInt(currentGame), currentVariant-1)
const nextVariant = () => updateCurrentGame(parseInt(currentGame), currentVariant+1)
const updateCurrentGame = (cg, vr = 0) => {
    if (cg > 25 || cg < 1) {
        return
    }
    if (vr >= games["" + cg].length || vr < 0) {
        return
    }
    currentGame = "" + cg
    currentVariant = vr
    switchGame(currentGame, currentVariant)
}

const currentBoard = () => (currentPosition == -1) ? games[currentGame][currentVariant].initialBoard : positions[currentPosition]

const next = () => {
    if (currentPosition < positions.length - 1) {
      currentPosition += 1
      refresh()
    }
}

const previous = () => {
    if (currentPosition > -1) {
      currentPosition -= 1
      refresh()
    }
}

const refresh = () => {
    var target = document.getElementById('actions')
    document.getElementById('gameNumber').innerHTML = currentGame
    document.getElementById('variantDescription').innerHTML = currentVariant == 0 ? 'See variants' : `Variant ${currentVariant}`
    document.querySelector('.variantSelector').setAttribute('style', games[currentGame].length <= 1 ? 'display:none' : 'display:inline')
    // document.querySelector('.rightColumn').innerHTML = texts[currentGame] ? texts[currentGame] : ''
    document.querySelector('.grandmasterYear').innerHTML = grandmasterYears[currentGame] ? grandmasterYears[currentGame] : ''

    board.position(currentBoard().split(' ')[0])

    fullAction = 1
    halfAction = 0
    currentAction = 0
    actionsString = ''
    for (action in parsedNotation.actions) {
        if (halfAction == 0)
            actionsString += '<div class="line">' + fullAction + '. '

        halfAction++

        if (parsedNotation.validActionCount >= currentAction + 1) {
            // if (currentAction == currentPosition+1) {
            //     actionsString += `<b>${parsedNotation.actions[currentAction]}</b> `
            // } else {
                actionsString += '<a class="move' + (currentPosition == currentAction ? ' currentMove' : '') + 
                '" href="javascript:currentPosition=' + currentAction +
                '; board.position(currentBoard())">' + parsedNotation.actions[currentAction] +
                '</a> '
            // }
        } else {
            actionsString += '<i>' + parsedNotation.actions[currentAction] + '</i><br/> '
        }

        currentAction++
        if (halfAction == 2) {
            halfAction = 0
            fullAction++
            actionsString += '</div>'
        }
    }

    target.innerHTML = actionsString + `<p>${games[currentGame][currentVariant].comment ? games[currentGame][currentVariant].comment : ''}</p>`
}

$(document).ready(init);
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58930438-3', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
